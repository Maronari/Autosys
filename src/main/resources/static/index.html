<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPC UA WebSocket Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let socket = new WebSocket("ws://localhost:8080/ws");

        const data = {
            labels: [],
            datasets: [
                {
                    label: "RandomDouble",
                    borderColor: "red",
                    backgroundColor: "rgba(255, 0, 0, 0.2)",
                    data: []
                },
                {
                    label: "RandomFloat",
                    borderColor: "blue",
                    backgroundColor: "rgba(0, 0, 255, 0.2)",
                    data: []
                }
            ]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: 'Время' } },
                    y: { title: { display: true, text: 'Значение' } }
                }
            }
        };

        let myChart;

        window.onload = function() {
            const ctx = document.getElementById('chart').getContext('2d');
            myChart = new Chart(ctx, config);
        };

        socket.onmessage = function(event) {
            let receivedData = JSON.parse(event.data);
            let nodeId = receivedData.nodeId;
            let value = parseFloat(receivedData.value);
            let time = new Date().toLocaleTimeString();

            if (!isNaN(value)) {
                data.labels.push(time);
                if (data.labels.length > 20) data.labels.shift(); // Убираем старые значения

                if (nodeId.includes("RandomDouble")) {
                    data.datasets[0].data.push(value);
                    if (data.datasets[0].data.length > 20) data.datasets[0].data.shift();
                } else if (nodeId.includes("RandomFloat")) {
                    data.datasets[1].data.push(value);
                    if (data.datasets[1].data.length > 20) data.datasets[1].data.shift();
                }

                myChart.update();
            }
        };
    </script>
</head>
<body>
    <h1>График значений OPC UA</h1>
    <canvas id="chart"></canvas>
</body>
</html>
